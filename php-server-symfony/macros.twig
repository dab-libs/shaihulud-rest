{% macro actionType(request) %}
{{   request.operationId|pascalCase ~ 'ActionInterface' }}
{% endmacro %}

{% macro controllerType(request) %}
{{   request.operationId|pascalCase ~ 'Controller' }}
{% endmacro %}

{% macro methodName(request) %}
{{   request.operationId }}
{% endmacro %}

{% macro parameterType(schema, name, parentName) %}
{%   if schema contains '$ref' %}
{%     set typeName = schema['$ref'] | replaceAll('#/components/schemas/(\w+)', '\u$1') %}
{%   elseif schema.type == 'string' %}
{%     set typeName = 'string' %}
{%   elseif schema.type == 'integer' %}
{%     set typeName = 'int' %}
{%   elseif schema.type == 'number' %}
{%     set typeName = 'float' %}
{%   elseif schema.type == 'boolean' %}
{%     set typeName = 'bool' %}
{%   elseif schema.type == 'array' %}
{%     set typeName = 'array' %}
{%   elseif schema.type == 'object' %}
{%     set typeName = parentName ~ ' ' ~ name | pascalCase %}
{%   endif %}
{{   typeName }}
{% endmacro %}

{% macro operationsType(schema, name, parentName) %}
{{   parameterType(schema, name, parentName) | upperCaseFirst ~ 'Operations' }}
{% endmacro %}

{% macro literal(value) %}
{{   value is null ? 'null' : value | quoteString("'") | raw }}
{% endmacro %}

{% macro defaultValueLiteral(schema) %}
{%   if schema contains '$ref' %}
{%     set value = null %}
{%   else %}
{%     set value = schema.default %}
{%   endif %}
{{   literal(value) }}
{% endmacro %}

{% macro stringOptions(required, schema) %}
required: {{ literal(required) }}
, minLength: {{ literal(schema.minLength) }}
, maxLength: {{ literal(schema.maxLength) }}
{% endmacro %}

{% macro numberOptions(required, schema) %}
required: {{ literal(required) }}
, maximum: {{ literal(schema.maximum) }}
, exclusiveMaximum: {{ literal(schema.exclusiveMaximum) }}
, minimum: {{ literal(schema.minimum) }}
, exclusiveMinimum: {{ literal(schema.exclusiveMinimum) }}
, multipleOf: {{ literal(schema.multipleOf) }}
{% endmacro %}

{% macro boolOptions(required, schema) %}
required: {{ literal(required) }}
{% endmacro %}

{% macro arrayOptions(name, required, schema) %}
{%   set type = parameterType(schema.items, 'item', name) %}
required: {{ literal(required) }}
, minItems: {{ literal(schema.minItems) }}
, maxItems: {{ literal(schema.maxItems) }}
, validateItem: fn(?{{ type }} $value, string $name) => {{ operationsType(schema.items, 'item', name) }}::validate(value: $value, name: $name, {{ typeOptions(name ~ 'Item', true, schema.items) }}){% endmacro %}

{% macro typeOptions(name, required, schema) %}
{%   if schema contains '$ref' %}
{%     set typeName = schema['$ref'] | replaceAll('#/components/schemas/(\w+)', '\u$1') %}
{%   elseif schema.type == 'string' %}
{%     set options = stringOptions(required, schema) %}
{%   elseif schema.type == 'integer' %}
{%     set options = numberOptions(required, schema) %}
{%   elseif schema.type == 'number' %}
{%     set options = numberOptions(required, schema) %}
{%   elseif schema.type == 'boolean' %}
{%     set options = boolOptions(required, schema) %}
{%   elseif schema.type == 'array' %}
{%     set options = arrayOptions(name, required, schema) %}
{%   elseif schema.type == 'object' %}
{%     set typeName = classNameForObject %}
{%   endif %}
{{   options }}
{% endmacro %}
